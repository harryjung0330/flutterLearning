# Data Persistence and Communicating with the Internet 
- 대부분의 어플리케이션은 CRUD( Create, Read, Update, Delete)를 수행해야한다.  
- 데이터는 local이나 remote 데이터베이스에 보관될수있고, 어느 케이스던 데이터는 일단 JSON으로 변형이 되어야한다! 
  
### Converting Dart Models into JSON  
- JSON: key-value pair로 구성된 텍스트포맷
- ex)  
```
{
	"id": "0001",
	"type": "donut",
	"name": "Cake",
	"ppu": 0.55,
	"batters":
		{
			"batter":
				[
					{ "id": "1001", "type": "Regular" },
					{ "id": "1002", "type": "Chocolate" },
					{ "id": "1003", "type": "Blueberry" },
					{ "id": "1004", "type": "Devil's Food" }
				]
		},
	"topping":
		[
			{ "id": "5001", "type": "None" },
			{ "id": "5002", "type": "Glazed" },
			{ "id": "5005", "type": "Sugar" },
			{ "id": "5007", "type": "Powdered Sugar" },
			{ "id": "5006", "type": "Chocolate with Sprinkles" },
			{ "id": "5003", "type": "Chocolate" },
			{ "id": "5004", "type": "Maple" }
		]
}
```  
- serialization: 다트의 객체를 Json string으로 변경하는 프로세스  
- deserialization: Json string을 다트의 객체로 변경하는 프로세스  
  
##### 직접하기  
1. root에 asset 폴더추가후 폴더 아래 pizzaList.json 파일 추가:  
```
[
  {
    "id": 1,
    "pizzaName": "Margherita",
    "description": "Pizza with tomato, fresh mozzarella and basil",
    "price": 8.75,
    "imageUrl": "images/margherita.png"
  },
  {
    "id": 2,
    "pizzaName": "Marinara",
    "description": "Pizza with tomato, garlic and oregano",
    "price": 7.50,
    "imageUrl": "images/marinara.png"
  },
  {
    "id": 3,
    "pizzaName": "Napoli",
    "description": "Pizza with tomato, garlic and anchovies",
    "price": 9.50,
    "imageUrl": "images/marinara.png"
  },
  {
    "id": 4,
    "pizzaName": "Carciofi",
    "description": "Pizza with tomato, fresh mozzarella and artichokes",
    "price": 8.80,
    "imageUrl": "images/marinara.png"
  },
  {
    "id": 5,
    "pizzaName": "Bufala",
    "description": "Pizza with tomato, buffalo mozzarella and basil",
    "price": 12.50,
    "imageUrl": "images/marinara.png"
  }
]
```  
2. pubspec.yaml에 asset경로 지정  
3. main.dart  
```
import 'dart:convert';
import "./pizza.dart";
import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter JSON Demo',
      theme: ThemeData(

        primarySwatch: Colors.blue,
        visualDensity: VisualDensity.adaptivePlatformDensity
      ),
      home: const MyHomePage(),
    );
  }


}
class MyHomePage extends StatefulWidget
{
  const MyHomePage({Key? key}) : super(key: key);

  @override
  _MyHomePageState createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  String pizzaString = "";

  void initState() {
    readJsonFile();
    super.initState();
  }
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text("JSON")),
      body: Container(
        child: FutureBuilder(
          future: readJsonFile(),
          builder: (BuildContext context, AsyncSnapshot<List<Pizza>> pizzas)
            {
              return ListView.builder(
                itemCount: (pizzas.data == null) ? 0 :pizzas.data!.length, // future의 값을 pizzas.data
                itemBuilder: (BuildContext context, int position)
                {
                  return ListTile(
                    title: Text(pizzas.data![position].pizzaName),
                    subtitle: Text(pizzas.data![position].description + " - \$ " + pizzas.data![position].price.toString()),
                  );
                },
              );
            }
        )
      )
    );
  }

  Future<List<Pizza>> readJsonFile() async{
    String myString = await DefaultAssetBundle.of(context).loadString("assets/pizzalist.json");

    List<dynamic> myMap = jsonDecode(myString);                     //jsonDecode => method for dart library. decode jsonString

    List<Pizza> myPizzas = [];
    myMap.forEach((dynamic pizza){
      Pizza myPizza = Pizza.fromJson(pizza);                       
      myPizzas.add(myPizza);
    });

    return myPizzas;

  }


}
```  
- DefaultAssetBundle.of(context).loadString("path to file");  -> 지정한 path의 파일을 읽고 Future<String>형태로 리턴  
- jsonDecode(String) => dynamic type을 리턴한다!  
4. pizza.dart  
```
class Pizza{
  late int id;
  late String pizzaName;
  late String description;
  late double price;
  late String imageUrl;

  Pizza.fromJson(Map<String, dynamic> json)     //named constructor
  {
    this.id = json["id"];
    this.pizzaName = json["pizzaName"];
    this.description = json["description"];
    this.price = json["price"];
    this.imageUrl = json["imageUrl"];
  }

}
```  
- Pizza.fromJson() -> Json (Map<String, dynamic>)을 받아서 Pizza 객체를 리턴!  
- JsonString ->(jsonDecode) Map<String, dynamic ->(Pizza.fromJson) Pizza 과정으로 변환!! 
 
![01_pizza]()
##### serialize Json  
1. Pizza.dart에 아래 코드 추가  
```
Map<String, dynamic> toJson(){
return {
"id": id,
"pizzaName": pizzaName,
"description": description,
"price": price,
"imageUrl" :imageUrl
};
}
```  
- toJson()에서 dynamic에 해당되는 타입은 json으로 변환가능(toJson())함수가 있어야한다! (재귀로해도 안된다!) 
2. main.dart  
```
String converToJSON(List<Pizza> pizzas)
{
  String json = "[";
  pizzas.forEach((pizza){
  json += jsonEncode(pizza);
    
  });
  json += "]";
  return json;
}
```  
- jsonEncode(dynamic ) => 객체가 toJson()함수가 있다면, jsonEncode()가 그 객체의 toJson()을 호출후, String으로 변환!  
